<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="description" content="ViewerApps - Grow Your Audience Instantly with our social media boosting services" />
    <meta name="theme-color" content="#4f46e5" />
    
    <!-- Performance Optimization: Preload critical assets -->
    <link rel="preload" href="/src/index.css" as="style" />
    <link rel="preload" href="/src/main.tsx" as="script" />
    
    <!-- Performance Optimization: Preconnect to third-party domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
    
    <!-- PWA Support -->
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" type="image/png" href="/icon-192x192.png" />
    <link rel="apple-touch-icon" href="/icon-192x192.png" />
    
    <!-- Google Fonts with display=swap for better performance -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" />
    
    <!-- Critical CSS Inline -->
    <style>
      /* Critical rendering path CSS */
      body {
        margin: 0;
        padding: 0;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background-color: #f8fafc;
        color: #1e293b;
      }
      /* Prevent layout shifts during loading */
      .content-placeholder {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      /* Loading spinner with reduced CLS */
      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(79, 70, 229, 0.2);
        border-radius: 50%;
        border-top-color: #4f46e5;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      /* Prevent FOUC */
      .js-loading * {
        transition: none !important;
      }
    </style>
    
    <title>ViewerApps - Grow Your Audience Instantly</title>
  </head>
  <body class="js-loading">
    <div id="root">
      <!-- Minimal loading state to reduce CLS -->
      <div class="content-placeholder">
        <div class="loading-spinner"></div>
      </div>
    </div>
    
    <!-- Remove JS loading class once the page starts loading -->
    <script>
      // Remove the JS loading class once the DOM is interactive
      document.addEventListener('DOMContentLoaded', function() {
        document.body.classList.remove('js-loading');
        
        // Optimize Stripe script loading - Only load on payment pages
        const path = window.location.pathname.toLowerCase();
        const isPaymentPage = 
          path.includes('/payment') ||
          path.includes('/checkout') ||
          path.includes('/subscribe') ||
          path.includes('/billing') ||
          (path.includes('/pricing') && window.location.search.includes('checkout=true'));
        
        // If not on a payment page, block Stripe script loading
        if (!isPaymentPage) {
          // This function intercepts script loading requests
          const originalCreateElement = document.createElement;
          document.createElement = function(tag) {
            const element = originalCreateElement.call(document, tag);
            
            if (tag.toLowerCase() === 'script') {
              // Add an onload interceptor to any script element
              const originalSetAttribute = element.setAttribute;
              element.setAttribute = function(name, value) {
                if (name === 'src' && (
                  value.includes('stripe.com') || 
                  value.includes('stripe.network') ||
                  value.includes('stripe-js')
                )) {
                  console.log('Blocked Stripe script loading on non-payment page:', value);
                  // Don't set the src attribute for Stripe scripts
                  return element;
                }
                return originalSetAttribute.call(this, name, value);
              };
            }
            
            return element;
          };
        }
      });
      
      // Register service worker for PWA support
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/service-worker.js')
            .then(function(registration) {
              console.log('ServiceWorker registration successful with scope: ', registration.scope);
            })
            .catch(function(err) {
              console.log('ServiceWorker registration failed: ', err);
            });
        });
      }
      
      // Performance monitoring
      if ('performance' in window && 'PerformanceObserver' in window) {
        // Create performance observer for LCP
        const lcpObserver = new PerformanceObserver((entryList) => {
          const entries = entryList.getEntries();
          const lastEntry = entries[entries.length - 1];
          console.log('LCP:', lastEntry.startTime);
        });
        lcpObserver.observe({ type: 'largest-contentful-paint', buffered: true });
        
        // Create performance observer for CLS
        let clsValue = 0;
        const clsObserver = new PerformanceObserver((entryList) => {
          for (const entry of entryList.getEntries()) {
            if (!entry.hadRecentInput) {
              clsValue += entry.value;
            }
          }
          console.log('CLS:', clsValue);
        });
        clsObserver.observe({ type: 'layout-shift', buffered: true });
        
        // Create performance observer for FID
        const fidObserver = new PerformanceObserver((entryList) => {
          for (const entry of entryList.getEntries()) {
            const delay = entry.processingStart - entry.startTime;
            console.log('FID:', delay);
          }
        });
        fidObserver.observe({ type: 'first-input', buffered: true });
      }
    </script>
    
    <!-- Main application script with defer to avoid blocking render -->
    <script type="module" src="/src/main.tsx" defer></script>
  </body>
</html>